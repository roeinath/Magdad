# from general import *

from APIs.TalpiotAPIs import SecretCodeManager
from web_framework.server_side.infastructure.components.Image import Image
from web_framework.server_side.infastructure.components.code_block import CodeBlock
from web_framework.server_side.infastructure.components.hyper_link import HyperLink
from web_framework.server_side.infastructure.components.label import Label
from web_framework.server_side.infastructure.components.stack_panel import StackPanel
from web_framework.server_side.infastructure.constants import *
from web_framework.server_side.infastructure.page import Page
from web_framework.server_side.infastructure.ui_component import UIComponent


class BotSignup(Page):
    def __init__(self, params={}):
        super().__init__(params)
        self.sp = StackPanel([])

    @staticmethod
    def get_title() -> str:
        return "חיבור לבוט"

    @staticmethod
    def is_authorized(user):
        return user.secret_code is not None

    def get_page_ui(self, user=None) -> UIComponent:
        self.sp = StackPanel([])
        self.sp.add_component(Label("כניסה ל-TalpiBot", fg_color=COLOR_PRIMARY_DARK, size=SIZE_EXTRA_LARGE))

        img_url = "data:image/jpeg;base64,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"
        self.sp.add_component(Image(img_url, scale=0.1))

        quick_start_url = "https://" + SecretCodeManager.genereate_secret_url("TalpiBot", user.secret_code)
        self.sp.add_component(HyperLink("לחצו כאן לכניסה מהירה", url=quick_start_url, size=SIZE_EXTRA_LARGE))

        self.sp.add_component(Label("או היכנסו לטלגרם וחפשו את איש הקשר TalpiBot@"))
        self.sp.add_component(Label("שלחו את ההודעה עם הקוד הסודי שלכם"))
        self.sp.add_component(CodeBlock(f"\n/start {user.secret_code}\n", width='65vw'))
        self.sp.add_component(Label("במידה ולא עובד, פנו לרמ\"ד TalpiX", fg_color='grey'))
        return self.sp
